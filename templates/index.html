{% extends "base.html" %}
{% load static from staticfiles %}


{% block header_block %}
{# https://github.com/kswedberg/jquery-carousel-lite #}
<section id="carousel">
	<div class="selected">
		{% with featured_coupons|random as coupon %}
			<img src="{{ coupon.coupon.merchant.get_image }}" alt="{{ coupon.coupon.merchant.name }}" />
			<h2>{{ coupon.coupon.short_desc }} at {{ coupon.coupon.merchant.name }}</h2>
			<p class="description">{{ coupon.coupon.description }}</p>
			<p>
				<a class="button" href="/coupon/{{ coupon.coupon.merchant.name_slug }}/{{ coupon.coupon.desc_slug }}/{{ coupon.coupon.id }}/">Use coupon</a>
				See more from <a class="merchantlink" href="/coupons/{{ coupon.coupon.merchant.name_slug }}/{{ coupon.coupon.merchant.id }}/">{{ coupon.coupon.merchant.name }}</a>
			</p>
		{% endwith %}
	</div>
	<nav class="carousel">
		<ul>
			{% for coupon in featured_coupons %}
				<li
					data-image="{{ coupon.coupon.merchant.get_image }}"
					data-merchantname="{{ coupon.coupon.merchant.name }}"
					data-shortdesc="{{ coupon.coupon.short_desc }}"
					data-description="{{ coupon.coupon.description }}"
					data-couponurl="/coupon/{{ coupon.coupon.merchant.name_slug }}/{{ coupon.coupon.desc_slug }}/{{ coupon.coupon.id }}/"
					data-merchanturl="/coupons/{{ coupon.coupon.merchant.name_slug }}/{{ coupon.coupon.merchant.id }}/"
					>
					<img src="{{ coupon.coupon.merchant.get_image }}" alt="{{ coupon.coupon.merchant.name }}" />
				</li>
			{% endfor %}
		</ul>
	</nav>
	<nav class="paging">
		<a href="#" class="prev">&lt;</a>
		<a href="#" class="next">&gt;</a>
	</nav>
</section>

<script>
	$('#carousel .carousel ul').on('click', 'li', function(){
		// unmark
		$(this).closest('ul').find('img').removeClass('active');
		// mark
		$(this).children('img:first').addClass('active');
		// set data
		var db = $(this).data();
		$('#carousel .selected img').attr('src', db.image);
		$('#carousel .selected h2').text(db.shortdesc + ' at ' + db.merchantname);
		$('#carousel .selected .description').text(db.description);
		$('#carousel .selected .button').attr('href', db.couponurl);
		$('#carousel .selected .merchantlink').attr('href', db.merchanturl);
	});
</script>

<style>
	#carousel {
		width: 940px;
		margin: 0 auto;
	}
	#carousel .selected {
		color: #fff;
	}
	#carousel .selected .button {
		background-color: rgb(77, 194, 161);
		padding: 5px 10px;
		margin-right: 20px;
		font-weight: bold;
	}
	#carousel .selected img {
		float: left;
		max-width: 150px;
		max-height: 150px;
		margin-right: 20px;
	}
	#carousel .selected h2 {
		color: #fff;
	}
	#carousel .selected a {
		color: #fff;
	}
	#carousel .carousel {
		overflow: hidden;
		height: 94px;
		clear: both;
	}
	#carousel .carousel li {
		height: 104px;
	}
	#carousel .carousel li img {
		max-width: 94px;
		max-height: 94px;
		padding-top: 10px;
	}
	#carousel .carousel li img.active {
		padding-top: 0;
	}
	#carousel nav.paging {
		text-align: center;
	}
	#carousel nav.paging a {
		color: #fff;
	}
</style>

<script src="{% static "js/carousel/jcarousellite.min.js" %}"></script>
<script>
$('#carousel').jCarouselLite({
	autoCSS: true,
	autoWidth: true,
	visible: 10,
	responsive: true,
	btnNext: '.next',
	btnPrev: '.prev',
	scroll: 10
});
</script>
{% endblock %}


{% block header_block_old %}

            <div class="main-slider-wrap">
              <div class="row">
                <div class="column">
                  <div class="main-slider flexslider white">
                    <ul class="slides">
                        {% for coupon in featured_coupons %}
                      <li>
                        <p class="h1"><a target="_blank" rel="comm" href="/coupon/{{ coupon.coupon.merchant.name_slug }}/{{ coupon.coupon.desc_slug }}/{{ coupon.coupon.id }}/">{{ coupon.coupon.short_desc }} at {{ coupon.coupon.merchant.name }}</a></p>
                        <div class="row">
                          <div class="large-8 columns large-centered">
                            <div class="content">
                              <p class="caption">
                                <a target="_blank" rel="comm" href="/coupon/{{ coupon.coupon.merchant.name_slug }}/{{ coupon.coupon.desc_slug }}/{{ coupon.coupon.id }}/">{{ coupon.coupon.description }}</a>
                                <a target="_blank" rel="comm" href="/coupon/{{ coupon.coupon.merchant.name_slug }}/{{ coupon.coupon.desc_slug }}/{{ coupon.coupon.id }}/" class="ir icon tag">Learn More</a>
                              </p>
                                <a href="/coupons/{{ coupon.coupon.merchant.name_slug }}/{{ coupon.coupon.merchant.id }}/">
                                  <figure>
                                    <img src="{{ coupon.coupon.merchant.get_image }}" alt="{{ coupon.coupon.merchant.name }}" style="max-height: 100px">
                                  </figure>
                                </a>
                            </div>
                          </div>
                        </div>
                      </li>
                        {% endfor %}

                    </ul>
                  </div>
                </div>
              </div>
            </div>

{% endblock %}


{% block main %}

          <div role="main">


            <div class="stripe-regular items-carousel-wrap">
              <div class="row">
                <div class="column">
                  <h2>New Coupons</h2>
                </div>
              </div>
              <div class="row collapse">
                <div class="column">
                  <div class="items-carousel flexslider">
                    <ul class="rr slides">
                        {% for coupon in new_coupons %}
                        <li>
                            <div class="wrapper-3 item-thumb"  data-rid="{{ coupon.ref_id }}">
                                <div class="top">
                                    <a href="/coupons/{{ coupon.merchant.name_slug }}/{{ coupon.merchant.id }}/">
                                        <figure class="prodimg">
                                            <img src="{{ coupon.get_image }}" alt="{{ coupon.description }}" style="display:normal">
                                        </figure>
                                    </a>
                                    <h2 class="alt" style="max-height: 45px; overflow: hidden;"><a target="_blank" href="/coupon/{{ coupon.merchant.name_slug }}/{{ coupon.desc_slug }}/{{ coupon.id }}/">{{ coupon.description }}</a></h2>
                                </div>
                                <div class="bottom">
                                    <p class="value secondary">{{ coupon.short_desc }}</p>
                                    <h6><a href="/coupons/{{ coupon.merchant.name_slug }}/">{{ coupon.merchant.name }}</a></h6>
                                    <a href="/coupon/{{ coupon.merchant.name_slug }}/{{ coupon.desc_slug }}/{{ coupon.id }}/" target="_blank" class="input button green secondary">Learn more</a>
                                </div>
                            </div>
                        </li>
                        {% endfor %}

                    </ul>
                  </div>
                </div>
              </div>
            </div>

            <div class="stripe-white big items-carousel-wrap">
              <div class="row">
                <div class="column">
                  <h2>Popular Coupons</h2>
                </div>
              </div>
              <div class="row collapse">
                <div class="column">
                  <div class="items-carousel flexslider">
                    <ul class="rr slides">

                        {% for coupon in pop_coupons %}
                        <li>
                            <div class="wrapper-3-alt item-thumb" data-rid="{{ coupon.ref_id }}">
                                <div class="top">
                                    <a href="/coupons/{{ coupon.merchant.name_slug }}/{{ coupon.merchant.id }}/">
                                        <figure class="prodimg">
                                            <img src="{{ coupon.get_image }}" alt="{{ coupon.description }}" style="display:normal">
                                        </figure>
                                    </a>
                                    <h2 class="alt" style="max-height: 45px; overflow: hidden;"><a target="_blank" href="/coupon/{{ coupon.merchant.name_slug }}/{{ coupon.desc_slug }}/{{ coupon.id }}/">{{ coupon.description }}</a></h2>
                                </div>
                                <div class="bottom">
                                    <p class="value secondary">{{ coupon.short_desc }}</p>
                                    <h6><a href="/coupons/{{ coupon.merchant.name_slug }}/">{{ coupon.merchant.name }}</a></h6>
                                    <a target="_blank" href="/coupon/{{ coupon.merchant.name_slug }}/{{ coupon.desc_slug }}/{{ coupon.id }}/" class="input button green secondary">Learn More</a>
                                </div>
                            </div>
                        </li>
                        {% endfor %}

                    </ul>
                  </div>
                </div>
              </div>
            </div>

          </div>

{% endblock %}

{% block end_of_body %}
<script type="text/javascript">
    try{
        mixpanel.track("Home Page Opened", {
            "utm_source"    : "{{ visitor.acquisition_source }}",
            "utm_medium"    : "{{ visitor.acquisition_medium }}",
            "utm_term"      : "{{ visitor.acquisition_term }}",
            "utm_content"   : "{{ visitor.acquisition_content }}",
            "utm_campaign"  : "{{ visitor.acquisition_campaign }}"
        });
    }catch(e){}
</script>
{% endblock %}



